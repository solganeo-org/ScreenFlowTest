<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Espace sécurisé - Conseil national de l'ordre des experts-comptables">
  <title>Portail Sécurisé | Conseil national de l'ordre des experts-comptables</title>
  
  <!-- Polices Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- CSS avec chemins corrects -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/reset.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/forms.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/utilities.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
  
  <!-- Script Lightning depuis le domaine Lightning -->
  <script src="https://solganeo--carboneio.sandbox.lightning.force.com/lightning/lightning.out.js"></script>
</head>
<body>
  <div class="page-wrapper">
    <!-- Éléments décoratifs de l'arrière-plan -->
    <div class="background-decoration">
      <div class="decoration-circle decoration-circle-1"></div>
      <div class="decoration-circle decoration-circle-2"></div>
    </div>
    
    <!-- Ligne décorative supérieure -->
    <div class="top-line"></div>
    
    <!-- Header avec logo -->
    <header class="site-header">
      <div class="logo-container">
        <!-- Logo officiel (remplacé par une version utilisant url_for) --> 
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Conseil national de l'ordre des experts-comptables" class="logo">
      </div>
    </header>
    
    <!-- Contenu principal -->
    <main class="page-content">
      <div class="main-title-container animate-in">
        <h1 class="main-title">
          Authentification et <span class="main-title-highlight">Accès Sécurisé</span>
        </h1>
        <p class="main-subtitle">Espace réservé aux membres du Conseil national de l'ordre des experts-comptables</p>
        <div class="separator"></div>
      </div>
      
      <div class="card-container">
        <div class="card animate-in" id="flowContainer">
          <!-- Le Flow Salesforce sera rendu ici -->
        </div>
        <div class="card-shadow"></div>
      </div>
    </main>
  </div>
  
  <!-- Container pour les feux d'artifice -->
  <div class="pyro">
    <div class="before"></div>
    <div class="after"></div>
  </div>

  <script>
    // Initialisation du Flow Salesforce
    $Lightning.use("c:embeddedFlowApp", function() {
      // Créer et monter le composant de Flow
      $Lightning.createComponent("c:embeddedFlow", {}, "flowContainer");
      
      // Animer les éléments au chargement
      document.querySelectorAll('.animate-in').forEach((element, index) => {
        element.style.animationDelay = (index * 0.1) + 's';
      });
      
      // Attendre que le Flow charge et appliquer les styles personnalisés
      setTimeout(() => {
        const flowEl = document.querySelector("flowruntime-flow");
  
        if (flowEl && flowEl.shadowRoot) {
          const style = document.createElement("style");
          style.textContent = `
            button.slds-button_brand {
              background-color: var(--primary) !important;
              border: none !important;
              border-radius: var(--radius-md) !important;
              padding: 0.875rem 1.75rem !important;
              font-size: var(--font-size-sm) !important;
              font-weight: 600 !important;
              letter-spacing: 0.5px !important;
              text-transform: uppercase !important;
              color: white !important;
              transition: var(--transition-normal) !important;
              box-shadow: 0 4px 12px rgba(0, 46, 95, 0.15) !important;
              position: relative !important;
              overflow: hidden !important;
            }
  
            button.slds-button_brand:hover {
              background-color: var(--primary-dark) !important;
              transform: translateY(-2px) !important;
              box-shadow: 0 6px 16px rgba(0, 46, 95, 0.2) !important;
            }
            
            input, select, textarea {
              border-radius: var(--radius-md) !important;
              border: 1px solid var(--border) !important;
              padding: 0.875rem 1rem !important;
              font-size: var(--font-size-md) !important;
              transition: var(--transition-fast) !important;
              background-color: rgba(248, 250, 253, 0.8) !important;
              box-shadow: 0 2px 3px rgba(0, 0, 0, 0.01) inset !important;
              width: 100% !important;
              color: var(--text-primary) !important;
            }
            
            input:focus, select:focus, textarea:focus {
              outline: none !important;
              border-color: var(--secondary) !important;
              box-shadow: var(--shadow-focus) !important;
              background-color: var(--background-light) !important;
            }
            
            .slds-rich-text-editor__output p {
              font-size: var(--font-size-md) !important;
              line-height: 1.7 !important;
              color: var(--text-primary) !important;
              text-align: center !important;
              margin-bottom: 1.5rem !important;
              font-family: var(--font-sans) !important;
            }
            
            .slds-form-element__label {
              font-weight: 600 !important;
              color: var(--primary) !important;
              font-size: var(--font-size-sm) !important;
              margin-bottom: 0.5rem !important;
              font-family: var(--font-sans) !important;
              display: block !important;
            }
            
            footer.slds-modal__footer {
              background: rgba(248, 250, 253, 0.8) !important;
              border-top: 1px solid var(--border) !important;
              display: flex !important;
              justify-content: center !important;
              padding: 1.5rem 0 !important;
              margin-top: 1.5rem !important;
            }
            
            .slds-card__header {
              padding-top: 0 !important;
              padding-bottom: 1rem !important;
              border: none !important;
              background: transparent !important;
            }
            
            .slds-text-heading_small {
              font-family: var(--font-sans) !important;
              font-weight: 600 !important;
              color: var(--primary) !important;
              font-size: var(--font-size-lg) !important;
              text-align: center !important;
            }
          `;
          flowEl.shadowRoot.appendChild(style);
          
          // Observer pour détecter les clics sur le bouton Finish
          const observer = new MutationObserver((mutations) => {
            const footerButtons = flowEl.shadowRoot.querySelectorAll('footer button');
            footerButtons.forEach(button => {
              if (button.textContent.includes('Finish') && !button.hasAttribute('data-fireworks-added')) {
                button.setAttribute('data-fireworks-added', 'true');
                button.addEventListener('click', showFireworks);
              }
            });
          });
          
          // Configuration de l'observateur
          observer.observe(flowEl.shadowRoot, {
            childList: true,
            subtree: true
          });
        }
      }, 1500);
      
      // Fonction pour afficher les feux d'artifice
      function showFireworks() {
        const pyro = document.querySelector('.pyro');
        pyro.style.display = 'block';
        
        // Ajouter une classe pour animer la carte
        const card = document.querySelector('.card');
        card.classList.add('success-animation');
        
        // Créer plus de feux d'artifice
        for (let i = 0; i < 10; i++) {
          setTimeout(() => {
            const newPyro = document.createElement('div');
            newPyro.className = 'pyro';
            newPyro.style.display = 'block';
            
            const before = document.createElement('div');
            before.className = 'before';
            const after = document.createElement('div');
            after.className = 'after';
            
            newPyro.appendChild(before);
            newPyro.appendChild(after);
            
            document.body.appendChild(newPyro);
            
            // Supprimer après l'animation
            setTimeout(() => {
              document.body.removeChild(newPyro);
            }, 3000);
          }, i * 250);
        }
        
        // Cacher les feux d'artifice après quelques secondes
        setTimeout(() => {
          pyro.style.display = 'none';
        }, 3000);
        
        // Afficher un message de succès discret
        const successMessage = document.createElement('div');
        successMessage.className = 'success-message';
        successMessage.innerHTML = '<span class="success-message-icon"></span> Connexion réussie';
        card.appendChild(successMessage);
        
        setTimeout(() => {
          successMessage.classList.add('show');
        }, 300);
      }
    }, "https://solganeo--carboneio.sandbox.my.salesforce-sites.com");
  </script>
  
  <!-- Script additionnel pour améliorer l'expérience utilisateur -->
  <script>
    // Effet de parallaxe subtil
    document.addEventListener('mousemove', function(e) {
      const card = document.querySelector('.card');
      if (!card) return;
      
      // Limiter l'effet à un mouvement très léger
      const moveX = (e.clientX - window.innerWidth / 2) * 0.005;
      const moveY = (e.clientY - window.innerHeight / 2) * 0.005;
      
      card.style.transform = `translate(${moveX}px, ${moveY}px)`;
    });
    
    // Ajout de l'effet de focus sur les champs au chargement
    window.addEventListener('load', function() {
      setTimeout(() => {
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
          input.addEventListener('focus', function() {
            this.closest('.slds-form-element')?.classList.add('form-element-focus');
          });
          
          input.addEventListener('blur', function() {
            this.closest('.slds-form-element')?.classList.remove('form-element-focus');
          });
        });
      }, 2000);
    });
  </script>
</body>
</html>